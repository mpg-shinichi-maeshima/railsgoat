version: 2
jobs:
  build:
    docker:
      - image: ruby:2.5.3
    steps:
      - run:
          name: Install dependencies
          command: |
            apt-get update -qq
            apt-get install -y build-essential libpq-dev nodejs
      - run:
          name: Install PhantomJS
          command: |
            wget -q https://bitbucket.org/ariya/phantomjs/downloads/phantomjs-2.1.1-linux-x86_64.tar.bz2
            tar jxf phantomjs-2.1.1-linux-x86_64.tar.bz2 phantomjs-2.1.1-linux-x86_64/bin/phantomjs --strip-components 2
            mv phantomjs /usr/local/bin/
            rm phantomjs-2.1.1-linux-x86_64.tar.bz2
      - checkout
      - run:
            name: Install all dependencies in Gemfile
            command: |
                 bundle install
      - run:
            name: Setup DB
            command: |
                 rails db:setup
      - run:
            name: Test vulnerabilities
            command: |
                 rails training
